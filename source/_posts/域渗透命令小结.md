---
title: 域渗透命令小结
comments: false
date: 2018-06-05 11:44:41
tags: 
- 域渗透
- 基础命令
categories: 
- 内网安全
typora-root-url: {{ title }}
typora-copy-images-to: {{ title }}
password: wohaimeixiewan
---

<blockquote class="blockquote-center">黑夜无论怎样悠长,<br>白昼总会到来</blockquote>

&emsp;&emsp;Bolg在15年就有这个打算，但是拖延症真的可怕😨，把以前工作中的知识汇总一下，有时候光知道，但就是说不出来，一句话还是不熟练，所以记录下来吧。

### 本地基础信息命令

```
ipconfig/all    
# 查看IP地址
ipconfig /release
ipconfig /renew 
# 释放地址 or 重新获取
whoami /all  
# 查看sid值
systeminfo
# 查询系统以及补丁信息
tasklist /svc
wmic process list brief
# 查看进程
tasklist /svc |findstr TermService 
netstat -ano |findstr `TermService pid`
# 查看某个进程网络使用
taskkill /im 进程名称
ntsd -c q -p
taskkill /pid[进程码] -t(结束该进程) -f(强制结束该进程以及所有子进程)
wmic process [handle/PID] delete
wmic process where "name='svchost.exe' and ExecutablePath<>'C:\\WINDOWS\\system32\\svchost.exe'" call Terminate（结束svchost.exe进程,路径为C:\WINDOWS\svchost.exe的(关键点：路径中的\一定要换成\\）
# 结束进程
wmic process call create notepad
# 新建notepad进程
wmic qfe  get hotfixid    
# 查看已安装过得补丁，这个很实用
wmic qfe list full /format:htable > hotfixes.htm  
# 详细的补丁安装
wmic  qfe      
# 查询补丁信息以及微软提供的下载地址
wmic process where pid="123" delete
# wmic 删除指定进程(根据进程PID)
ping hostname(主机名）   
# 显示该机器名的IP
net start   
# 查看当前运行的服务
net user      
# 查看本地组的用户
net localhroup administrators   
# 查看本机管理员组有哪些用户
net use      
# 查看会话
net session     
# 查看当前会话
net share    
WMIC share list brief
# 查看SMB指向的路径[即共享]
wmic share get name,path   
# 查看SMB指向的路径
wmic nteventlog get path,filename,writeable 
# 查询系统日志文件存储位置
net use \\IP\ipc$  password  /user:username      
# 建立IPC会话（工作组模式）
net use  z:  \\192.168.1.1      
# 建立映射到本机Z盘
net time \\172.16.16.2        
# 查询共享主机的是
at \\172.16.16.2 13:50 c:\windows\2009.exe      
# 在共享主机上执行
netstat  -ano      
# 查看开放的端口
netstat -an | find “3389”   
# 找到3389端口
net accounts      
# 查看本地密码策略
nbtstat –A ip      
# netbiso查询
net view      
# 查看机器注释或许能得到当前活动状态的机器列表，如果禁用netbios就查看不出来
echo %PROCESSOR_ARCHITECTURE%        
# 查看系统是32还是64位  
set                              
# 查看系统环境设置变量
net start                     
# 查看当前运行的服务
wmic process get caption,handle,commandline,executablepath
# 查看进程详情等等
wmic service list brief             
# 查看进程服务
wmic startup list brief       
# 查看启动程序信息
wmic product list brief           
# 查看安装程序和版本信息（漏洞利用线索）
wmic startup list full         
# 识别开机启动的程序
wmic process where(description="mysqld.exe") >>mysql.log  
# 获取软件安装路径
wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1
REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 0 /f
# 开启3389
for /r "path" %i in (*test*) do @echo %i
dir "path" /s /b /d | find "test"
wmic datafile where "drive='e:' and path='\\test\\' and FileName='cc' and Extension='cmd'" list
# 查找文件
grep 与 findstr有点类似
```



### 获取域内信息命令

```
dsquery ou
该域组织单位
net group /domain 
dsquery group                      
获得所有域用户组列表
net group qq_group /domain              
显示域中qq_group组的成员
net group qq_group /del /domain         
删除域中qq_group组
net group qq_group qq /del /domain      
删除域内qq_group 群组中的成员QQ
net group qq_group /add /domain         
增加域中的群组
net group "domain admins" /domain       
获得域管理员列表
net group "enterprise admins" /domain    
获得企业管理员列表
net localgroup administrators /domain   
获取域内置administrators组用（enterprise admins、domain admins）
net group "domain controllers" /domain   
获得域控制器列表
net group "domain computers" /domain   
dsquery computer domainroot -limit 65535 
获得所有域成员计算机列表
net user /domain     
dsquery user domainroot -limit 65535                  
获得所有域用户列表
net user someuser /domain              
获得指定账户someuser的详细信息
net accounts /domain               
获得域密码策略设置，密码长短，错误锁定等信息
nei view /domain                  
查询有几个域, 查询域列表
net view /domain:testdomain       
查看 testdomain域中的计算机列表
nltest /domain_trusts             
获取域信任信息
net user domain-admin /domain     
查看管理员登陆时间，密码过期时间，是否有登陆脚本，组分配等信息
net config Workstation         
查询机器属于哪个域
net time /domian               
查询主域服务器的时间
echo %logonserver%              
查看登陆到这台服务器的计算机名
net time  \\192.168.1.1         
查询远程共享主机192.168.1.1的时间
net use \\IP\ipc$ password /user:username@domain     
ipc$域内连接
net  view  \\dc2.backlion.com         
查看域控共享情况
dir \\dc2.backlion.com\SYSVOL /s /a > sysvol.txt  
列出sysvol日志记录
xcopy \\dc2.backlion.com\sysvol.txt sysvol.txt  /i  /e  /c
远程拷贝到本地sysvol日志
net user  /domain  bk bk123                 
修改域内用户密码，需要管理员权限
net  localgroup  administartors   SEZKL\backlion  /add     
将SEZKL域中的用户backlion添加到administrators组中
mstsc /admin                 
远程桌面登录到console会话解决hash无法抓出问题
gpupdate/force                  
更新域策略
psexec  \\192.168.1.3  -u administrator  -p  bk1234 -c  gsecdump.exe  -u
从域服务器密码存储文件windows/ntds/ntds.dit导出hash值出来
gsecdump  -a        
获取域登管理员登录过得hash值，这里gescdump为第三方导出AD域的hash值
tasklist /S ip /U domain\username /P /V    
查看远程计算机进程列
```



